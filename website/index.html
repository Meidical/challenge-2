<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Layout Tipo Sistema</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #e6e6e6;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: system-ui, sans-serif;
    }

    .frame {
      background: #f5f5f5;
      border-radius: 16px;
      padding: 16px;
      width: 100%;
      max-width: 1200px;
      height: 650px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }

    .layout {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 16px;
      height: 100%;
    }

    .panel {
      background: #bfbfbf;
      border-radius: 12px;
      position: relative;
      padding: 12px;
    }

    .panel.small {
      height: 100%;
    }

    .panel.large {
      height: 100%;
    }

    .label {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.2rem;
      font-weight: 600;
      color: #333;
    }

    /* Scroll simulada */
    .scroll-bar {
      position: absolute;
      top: 16px;
      right: 8px;
      width: 10px;
      height: calc(100% - 32px);
      background: #9a9a9a;
      border-radius: 6px;
    }

    .scroll-thumb {
      width: 100%;
      height: 80px;
      background: #7CFF8A;
      border-radius: 6px;
      margin-top: 40px;
    }

    /* Rodapé esquerdo */
    .bottom-left {
      display: grid;
      grid-template-columns: 70px 1fr;
      gap: 12px;
      margin-top: 12px;
    }

    .pill {
      background: #7CFF8A;
      border-radius: 24px;
      height: 44px;
      padding: 0 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #1f1f1f;
      font-size: 1rem;
      cursor: pointer;
    }

    .pill.outline {
      background: #7CFF8A;
      border: none;
    }
    .action {
      position: absolute;
      bottom: 16px;
      right: 16px;
      min-width: 120px;
      height: 44px;
      background: #7CFF8A;
      border-radius: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
    }
    .donor-card {
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid #dee2e6;
    }
    .donor-card.selected {
        border-color: #28a745 !important;
        border-width: 2px !important;
        background-color: #f8fff9;
        box-shadow: 0 4px 8px rgba(40, 167, 69, 0.2) !important;
    }
#waitingListContainer {
    max-height: 500px; 
    overflow-y: auto; 
    padding-right: 10px;
}
#waitingListContainer::-webkit-scrollbar {
    width: 6px;
}

#waitingListContainer::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

#waitingListContainer::-webkit-scrollbar-thumb {
    background: #7CFF8A; 
    border-radius: 10px;
}

#waitingListContainer::-webkit-scrollbar-thumb:hover {
    background: #5cff76;
}
  </style>
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <button class="pill border-0" style="min-width:100px;" onclick=Mostra(1)>Alocation</button>

      </div>
      <div class="col-md-1">
        <button class="pill border-0" style="min-width:100px;" onclick=Mostra(2)>Transplantation</button>

      </div>
      <div clas="col-md-10"></div>
    </div>
    <div class="row">&nbsp</div>
    <div class="row">
      <div class="frame" id="primeiro">
        <div class="layout">

          <!-- Coluna esquerda -->
          <div class="d-flex flex-column">
            <div class="panel small flex-grow-1 d-flex flex-column">
              <div class="fw-semibold mb-2">Waiting List</div>
              <div class="flex-grow-1" id="waitingListContainer" style="overflow-y:auto; padding-right:18px;"></div>
            </div>

            <div class="bottom-left">
              <div class="form-check form-switch m-0">
                <input class="form-check-input" id="mainSwitch" type="checkbox" role="switch" style="
            width:4.2em;
            height:2.1em;
            background-color:#5cff76;
            border-color:#5cff76;
            ">
              </div>
              <button class="pill border-0" id="submitBtn" style="min-width:140px;">Search</button>
            </div>
          </div>

          <!-- Painel direito -->
          <div class="panel large">
            <div id="resultChecklistContainer" class="flex-grow-1" style="overflow-y:auto; padding-right:18px;">
            </div>
            <button class="action border-0">Confirmar</button>
          </div>

        </div>
      </div>
      <div class="frame" id="segundo" style="display: none;">
        <!--segunda pagina-->
        <div class="layout">

          <!-- Coluna esquerda -->
          <div class="d-flex flex-column">
            <div class="panel small flex-grow-1 d-flex flex-column">
              <div class="fw-semibold mb-2">Waiting List</div>
              <div class="flex-grow-1" id="waitingListContainer" style="overflow-y:auto; padding-right:18px;"></div>
            </div>
            <div id="inputs" class="p-3 mt-3" style="background:#bfbfbf; border-radius:12px;">

              <!-- Linha 1: select -->
              <div class="mb-2">
                <label for="sourceSelect" class="form-label fw-semibold">Source</label>
                <select id="sourceSelect" class="form-select"
                  style="background:#bfbfbf; color:#1f1f1f; border:1px solid #888; border-radius:6px;">
                  <option value="bonemarrow">Bonemarrow</option>
                  <option value="peripheral">Peripheral Blood</option>
                </select>
              </div>

              <!-- Linha 2: inputs decimais lado a lado -->
              <div class="d-flex gap-2">
                <div class="flex-fill">
                  <label for="decimal1" class="form-label fw-semibold">Value 1</label>
                  <input type="number" step="0.01" id="decimal1" class="form-control"
                    style="background:#bfbfbf; border:1px solid #888; border-radius:6px; color:#1f1f1f;">
                </div>
                <div class="flex-fill">
                  <label for="decimal2" class="form-label fw-semibold">Value 2</label>
                  <input type="number" step="0.01" id="decimal2" class="form-control"
                    style="background:#bfbfbf; border:1px solid #888; border-radius:6px; color:#1f1f1f;">
                </div>
              </div>
            </div>
            <div class="bottom-left">
              <button class="pill border-0" id="submitBtn" style="min-width:140px;">Search</button>
            </div>
          </div>
          <!-- Painel direito -->
          <div class="panel large">
            <div class="fw-semibold mb-2">Checklist 2</div>

            <div id="resultChecklistContainer" class="flex-grow-1" style="overflow-y:auto; padding-right:18px;">
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">&nbsp</div>
    <div class="row">
      <div class="col-md-9"></div>
      <div class="col-md-2">
        <img src="image/logo.svg" alt="Logo" class="img-fluid">
      </div>
      <div class="col-md-1"></div>
    </div>
  </div>
  <script>
    function Mostra(id) {
      const primeiro = document.getElementById('primeiro');
      const segundo = document.getElementById('segundo');

      if (id === 1) {
        primeiro.style.display = 'block';  // Mostra o primeiro
        segundo.style.display = 'none';    // Esconde o segundo
      } else if (id === 2) {
        primeiro.style.display = 'none';   // Esconde o primeiro
        segundo.style.display = 'block';   // Mostra o segundo
      }
    }
    document.addEventListener('DOMContentLoaded', function () {
      const sw = document.getElementById('mainSwitch');
      const btn = document.getElementById('submitBtn');
      function atualizarTexto() {
        if (sw.checked) {
          btn.innerText = 'Search - Peripheral Blood';
        } else {
          btn.innerText = 'Search - Bonemarrow';
        }
      }
      atualizarTexto();
      sw.addEventListener('change', atualizarTexto);
    });
    //funcao get
    async function loadWaitingList() {
      try {
       const response = await fetch('http://localhost:5001/recipients');
        const data = await response.json();

        //const data = mockData; 
        const container = document.getElementById('waitingListContainer');
        if (!container) return; 

        container.innerHTML = '';

        data.forEach(item => {
          const checkboxId = `waiting_${item.recipient_id}`;
          const div = document.createElement('div');
          div.className = 'form-check mb-2';
          div.innerHTML = `
                    <input class="form-check-input" type="checkbox" id="${checkboxId}" value="${item.recipient_id}">
                    <label class="form-check-label" for="${checkboxId}">
                      <strong>${item.recipient_name}</strong> 
                      <small class="text-muted">(${item.recipient_age} anos - ${item.risk_group})</small>
                    </label>
                  `;
          container.appendChild(div);
        });

      } catch (error) {
        console.error('Erro ao carregar Waiting List:', error);
      }
    }
    document.addEventListener('DOMContentLoaded', loadWaitingList);
    //botao para post
   document.getElementById('submitBtn').addEventListener('click', async () => {
    const isPeripheral = document.getElementById('mainSwitch').checked;
    
    const selectedIds = Array.from(
        document.querySelectorAll('#waitingListContainer input[type="checkbox"]:checked')
    ).map(cb => cb.value); 

    if (selectedIds.length === 0) {
        alert('Selecione pelo menos um paciente da Waiting List.');
        return;
    }
    const source = isPeripheral ? "peripheral blood" : "bone marrow";   
    const payload = {
        "stem_cell_source": source
    };
    try {
        console.log(`Buscando matches para ${selectedIds[0]} com fonte: ${source}`);

         const response = await fetch(`http://Localhost:5001/recipient/${selectedIds[0]}/donor-matches`, {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify(payload)
        });
        console.log(response)
         const result = await response.json();

        fillResultChecklist(result);

    } catch (error) {
        console.error('Erro ao processar matches:', error);
    }
});

// Função para preencher a lista de resultados (Donors)
function fillResultChecklist(donors) {
    const container = document.getElementById('resultChecklistContainer');
    if (!container) return;
    //
    container.innerHTML = '<h5 class="mb-3">Donors Found:</h5>';
    //
    donors.forEach(donor => {
        const div = document.createElement('div');
        div.className = 'card mb-2 shadow-sm border-start border-primary donor-card';
        div.style.borderLeftWidth = '5px';
        div.dataset.donorId = donor.donor_id; 
        div.innerHTML = `
            <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="m-0">${donor.donor_name}</h6>
                    <span class="badge bg-primary">HLA: ${donor.HLA_score}</span>
                </div>
                <div style="font-size: 0.85em;" class="mt-1 text-muted">
                    <span><strong>ABO:</strong> ${donor.ABO_match}</span> | 
                    <span><strong>Survival:</strong> ${donor.expected_survival_time} days</span>
                </div>
            </div>
        `;
        //
        div.addEventListener('click', function() {
            document.querySelectorAll('.donor-card').forEach(c => c.classList.remove('selected'));
            this.classList.add('selected');
            console.log("Doador selecionado:", donor.donor_id);
        });
        container.appendChild(div);
    });
}
  </script>

</body>

</html>